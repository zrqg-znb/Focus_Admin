# 系统架构

## 整体架构

Focus Admin 采用前后端分离的架构设计，整体架构如下：

```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
│   浏览器 / 移动端 / 其他客户端                                │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       Nginx 网关                             │
│   静态资源服务 / 反向代理 / 负载均衡                          │
└─────────────────────────────────────────────────────────────┘
                    │                     │
                    ▼                     ▼
┌─────────────────────────┐   ┌─────────────────────────────┐
│      前端应用            │   │         后端 API            │
│  Vue 3 + Element Plus   │   │   Django + Django Ninja     │
│       web-ele           │   │       backend-django        │
└─────────────────────────┘   └─────────────────────────────┘
                                          │
                    ┌─────────────────────┼─────────────────────┐
                    │                     │                     │
                    ▼                     ▼                     ▼
            ┌───────────┐         ┌───────────┐         ┌───────────┐
            │   MySQL   │         │   Redis   │         │   文件存储  │
            │  数据持久化 │         │  缓存/队列 │         │   本地/OSS │
            └───────────┘         └───────────┘         └───────────┘
```

## 后端架构

### 分层设计

```
┌─────────────────────────────────────────────────────────────┐
│                      API 层 (Router)                        │
│           接收请求、参数验证、调用 Service                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   服务层 (Service)                           │
│              业务逻辑处理、事务管理                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    模型层 (Model)                            │
│              数据模型定义、ORM 操作                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据层 (Database)                         │
│                MySQL + Redis 数据存储                        │
└─────────────────────────────────────────────────────────────┘
```

### 模块划分

```
backend-django/
├── application/              # 应用配置层
│   ├── settings.py          # Django 配置
│   ├── urls.py              # URL 总路由
│   └── main.py              # Django Ninja API 注册
│
├── core/                     # 核心模块
│   ├── auth/                # 认证
│   ├── user/                # 用户
│   ├── role/                # 角色
│   ├── permission/          # 权限
│   ├── menu/                # 菜单
│   ├── dept/                # 部门
│   └── ...
│
├── apps/                     # 业务模块
│   ├── project_manager/     # 项目管理
│   ├── performance/         # 绩效管理
│   ├── code_compliance/     # 代码合规
│   └── ...
│
├── common/                   # 公共模块
│   ├── fu_crud.py           # CRUD 基类
│   ├── fu_model.py          # Model 基类
│   ├── fu_schema.py         # Schema 基类
│   └── fu_auth.py           # 认证装饰器
│
└── scheduler/                # 调度模块
    ├── service.py           # 调度服务
    └── tasks.py             # 任务定义
```

## 前端架构

### Monorepo 结构

```
web/
├── apps/                     # 应用层
│   └── web-ele/             # Element Plus 版本应用
│       └── src/
│           ├── api/         # API 请求封装
│           ├── components/  # 业务组件
│           ├── router/      # 路由配置
│           ├── store/       # Pinia Store
│           └── views/       # 页面视图
│
├── packages/                 # 共享包层
│   ├── @core/               # 核心包
│   │   ├── base/            # 基础组件
│   │   ├── composables/     # 组合式函数
│   │   └── preferences/     # 偏好设置
│   │
│   ├── effects/             # 副作用
│   ├── icons/               # 图标
│   ├── locales/             # 国际化
│   ├── stores/              # 共享状态
│   ├── styles/              # 样式
│   └── utils/               # 工具
│
└── internal/                 # 内部工具
    ├── lint-configs/        # Lint 配置
    ├── vite-config/         # Vite 配置
    └── tsconfig/            # TS 配置
```

### 数据流

```
┌──────────┐    dispatch    ┌──────────┐    request    ┌──────────┐
│   View   │ ──────────────▶│   Store  │ ─────────────▶│   API    │
│  (组件)   │                │ (Pinia)  │               │ (请求层)  │
└──────────┘                └──────────┘               └──────────┘
     ▲                           │                          │
     │                           │                          │
     │         state             │        response          │
     └───────────────────────────┴──────────────────────────┘
```

## 认证流程

```
┌──────────┐                 ┌──────────┐                 ┌──────────┐
│  客户端   │                 │  后端API  │                 │  数据库   │
└────┬─────┘                 └────┬─────┘                 └────┬─────┘
     │                            │                            │
     │   1. 登录请求 (用户名/密码)  │                            │
     │ ──────────────────────────▶│                            │
     │                            │   2. 验证用户               │
     │                            │ ──────────────────────────▶│
     │                            │                            │
     │                            │   3. 返回用户信息           │
     │                            │◀────────────────────────── │
     │                            │                            │
     │   4. 返回 JWT Token        │                            │
     │◀────────────────────────── │                            │
     │                            │                            │
     │   5. 携带 Token 请求        │                            │
     │ ──────────────────────────▶│                            │
     │                            │   6. 验证 Token & 权限      │
     │                            │ ──────────────────────────▶│
     │                            │                            │
     │   7. 返回业务数据           │                            │
     │◀────────────────────────── │                            │
     │                            │                            │
```

## 部署架构

### 单机部署

适用于开发环境和小型应用：

```
┌─────────────────────────────────────────┐
│               单台服务器                 │
│  ┌─────────────────────────────────┐   │
│  │            Nginx               │   │
│  │   - 静态资源 (前端 dist)        │   │
│  │   - 反向代理 (/api -> Django)  │   │
│  └─────────────────────────────────┘   │
│                   │                     │
│                   ▼                     │
│  ┌─────────────────────────────────┐   │
│  │       Django (Gunicorn)         │   │
│  └─────────────────────────────────┘   │
│            │              │             │
│            ▼              ▼             │
│      ┌─────────┐    ┌─────────┐        │
│      │  MySQL  │    │  Redis  │        │
│      └─────────┘    └─────────┘        │
└─────────────────────────────────────────┘
```

### 容器化部署

使用 Docker Compose：

```yaml
services:
  nginx:      # 前端 + 反向代理
  backend:    # Django 应用
  mysql:      # 数据库
  redis:      # 缓存
```
