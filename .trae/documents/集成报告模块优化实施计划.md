# 集成报告模块优化实施计划

基于对当前代码的分析，我发现邮件集成报告模块存在三个主要问题需要解决。以下是详细的实施计划：

## 1. 修复报告订阅页面VXE分页问题

**问题分析**：当前订阅页面 (`/views/integration-report/subscription/index.vue`) 禁用了分页 (`pagerConfig: { enabled: false }`)，且查询函数返回所有数据，未实现分页。

**解决方案**：
- 修改后端API `/api/integration-report/projects` 支持分页参数
- 在 `integration_api.py` 的 `list_projects` 函数中添加分页装饰器
- 更新前端订阅页面的 `proxyConfig`，使用分页查询
- 修改 `listIntegrationProjectsApi` API函数支持分页参数

**具体步骤**：
1. 在 `integration_schema.py` 添加分页查询参数模式
2. 在 `integration_api.py` 为 `list_projects` 函数添加 `@paginate` 装饰器
3. 更新前端API类型定义，添加分页响应类型
4. 修改订阅页面的 `gridOptions`，启用分页并更新查询逻辑

## 2. 拆分报告配置页面data.ts文件

**问题分析**：配置页面 (`/views/integration-report/config/index.vue`) 将所有逻辑放在单个文件中，不符合项目代码组织规范。

**解决方案**：参照项目配置页面 (`/views/project-manager/project/`) 的模式，将表单模式、列定义等提取到单独的 `data.ts` 文件。

**具体步骤**：
1. 创建 `/views/integration-report/config/data.ts` 文件
2. 将表单模式定义提取为 `useSearchFormSchema()` 函数
3. 将表格列定义提取为 `useColumns()` 函数
4. 将对话框表单定义提取为 `getConfigFormSchema()` 函数
5. 更新 `index.vue` 文件，导入并使用这些函数
6. 确保类型定义正确导入和导出

## 3. 实现邮件日志查询和前端页面

**问题分析**：数据库中存在 `IntegrationEmailDelivery` 模型，但缺少对应的查询API和前端管理页面。

**解决方案**：实现完整的邮件日志查询功能，包括后端API、前端页面和类型定义。

**后端实现步骤**：
1. 在 `integration_schema.py` 中添加邮件日志相关模式：
   - `EmailDeliveryRow` (单条记录)
   - `EmailDeliveryQueryIn` (查询参数)
   - `EmailDeliveryQueryOut` (分页响应)
2. 在 `integration_api.py` 中添加新的API端点：
   - `GET /api/integration-report/email-deliveries` (分页查询邮件日志)
   - 支持状态、日期范围、收件人等筛选条件
3. 在 `integration_service.py` 中添加查询逻辑函数

**前端实现步骤**：
1. 创建新页面 `/views/integration-report/email-logs/index.vue`
2. 创建对应的 `data.ts` 文件，定义表格列和搜索表单
3. 在API类型定义文件 (`/api/integration-report/index.ts`) 中添加：
   - 邮件日志相关接口类型定义
   - `listEmailDeliveriesApi` 查询函数
4. 实现VXE表格页面，支持分页、筛选和状态显示

**页面设计**：
- 表格列：记录日期、收件人、收件邮箱、主题、状态、错误信息、创建时间
- 筛选条件：状态(pending/sent/failed)、日期范围、收件人、邮箱
- 状态标签：使用不同颜色的标签显示发送状态

## 实施顺序建议

1. 首先拆分配置页面data.ts文件（相对独立，风险小）
2. 然后实现邮件日志功能（新增功能，不影响现有功能）
3. 最后修复订阅页面分页问题（需要前后端配合）

## 代码质量保证

- 所有修改遵循现有代码规范和命名约定
- 保持类型安全，更新相关TypeScript定义
- 测试每个功能的正常运作
- 确保分页功能与现有系统兼容